---
title: "R package Least Cost Path: Methods for modelling movement in the landscape"
author: "Joseph Lewis"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true # table of content true
    toc_depth: 3  # upto three depths of headings (specified by #, ## and ###)
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# 1. Introduction

This vignette describes <b>leastcostpath</b>, a package written for use in the R environment (R Core Team, 2016). It provides functionality to calculate Least Cost Paths using multiple cost functions that approximate the difficulty of moving across a landscape, taking into account obstacles and local fricion (e.g. slope). Furthermore, this package allows for the incorporation of cost when traversing across slope, as well as other factors such as landscape features. 

# 2. Setup

```{r libraries, echo = TRUE, message= FALSE, warning= FALSE}
library(rgdal)
library(rgeos)
library(sp)
library(raster)
library(gdistance)
library(leastcostpath)
```

```{r raster, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
r <- raster::raster(system.file('external/maungawhau.grd', package = 'gdistance'))

plot(r)
```

#3. Example 1: Least Cost Path Analysis (Slope only)

```{r slope_cs, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
cs <- create_slope_cs(dem = r, cost_function = 'tobler', neighbours = 16)
```

```{r lcp, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}

loc1 = cbind(2667876, 6479424)
loc1 = sp::SpatialPoints(loc1)

loc2 = cbind(2667677, 6478737)
loc2 = sp::SpatialPoints(loc2)

lcp <- create_lcp(cost_surface = cs, origin = loc1, destination = loc2, directional = FALSE)

plot(raster(cs))
plot(lcp[[1]], add = T, col = "red")
plot(lcp[[2]], add = T, col = "blue")
```

#4. Example 2: Least Cost Path Analysis (Slope and Traversal Across Slope)

```{r slope_traverse_cs, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
cs <- create_slope_cs(dem = r, cost_function = 'tobler', neighbours = 16) %>%
  "*" (create_traversal_cs(dem = r, neighbours = 16))
```

```{r lcp_2, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}

loc1 = cbind(2667876, 6479424)
loc1 = sp::SpatialPoints(loc1)

loc2 = cbind(2667677, 6478737)
loc2 = sp::SpatialPoints(loc2)

lcp <- create_lcp(cost_surface = cs, origin = loc1, destination = loc2, directional = FALSE)

plot(raster(cs))
plot(lcp[[1]], add = T, col = "red")
plot(lcp[[2]], add = T, col = "blue")
```

#5. Example 3: Least Cost Path Analysis (Slope, Traversal Across Slope, and Landscape Feature)

```{r slope_traverse_feature_cs, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
feature_loc = cbind(2667652, 6478997)
feature_loc = sp::SpatialPoints(feature_loc)

x <- seq(100, 1, length.out = 20)

cs <- create_slope_cs(dem = r, cost_function = 'tobler', neighbours = 16) %>%
  "*" (create_traversal_cs(dem = r, neighbours = 16)) %>%
  "*" (create_feature_cs(raster = r, locations = feature_loc, x))
```

```{r lcp_3, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}

loc1 = cbind(2667876, 6479424)
loc1 = sp::SpatialPoints(loc1)

loc2 = cbind(2667677, 6478737)
loc2 = sp::SpatialPoints(loc2)

lcp <- create_lcp(cost_surface = cs, origin = loc1, destination = loc2, directional = FALSE)

plot(raster(cs))
plot(feature_loc, add = T, col = "black")
plot(lcp[[1]], add = T, col = "red")
plot(lcp[[2]], add = T, col = "blue")
```

#6. Example 4: Least Cost Path Corridor (Slope, Traversal Across Slope, and Landscape Feature)

```{r slope_traverse_feature_cc, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
feature_loc = cbind(2667652, 6478997)
feature_loc = sp::SpatialPoints(feature_loc)

x <- seq(100, 1, length.out = 20)

cs <- create_slope_cs(dem = r, cost_function = 'tobler', neighbours = 16) %>%
  "*" (create_traversal_cs(dem = r, neighbours = 16)) %>%
  "*" (create_feature_cs(raster = r, locations = feature_loc, x))
```

```{r cc, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}

loc1 = cbind(2667876, 6479424)
loc1 = sp::SpatialPoints(loc1)

loc2 = cbind(2667677, 6478737)
loc2 = sp::SpatialPoints(loc2)

cc <- create_cost_corridor(cs, loc1, loc2)

plot(cc)
```

#7. Example 5: Least Cost Path Network (Slope and Traversal Across Slope)

```{r slope_traverse_feature_ntwk, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
locs <- sp::spsample(as(r, 'SpatialPolygons'),n=25,'regular')

lcp_network <- create_slope_cs(dem = r, cost_function = 'tobler', neighbours = 16) %>%
  "*" (create_traversal_cs(dem = r, neighbours = 16)) %>%
  create_lcp_network(cost_surface = ., locations = locs, parallel = FALSE)

plot(r)
plot(locs, add = T)
plot(lcp_network, add = T, col = "red")
```

#8. Example 6: Cumulative Least Cost Paths

```{r cumulative, echo = TRUE,  fig.height = 6, fig.width = 6, warning = FALSE}
cumulative_lcps <- create_cumulative_lcps(lcps = lcp_network, raster = r, rescale = TRUE)

plot(cumulative_lcps)
```
